import{C as e,F as t,G as n,I as r,J as i,L as a,M as o,Nt as s,R as c,X as l,Z as u,a as d,b as f,d as p,f as m,it as h,jt as g,m as _,nt as v,p as y,t as b,u as x,ut as S,v as C,w,y as T}from"./_plugin-vue_export-helper-7ehu3f-T.js";import{n as E,o as D,s as O}from"./http-BtjM28wp.js";import{Ct as k,I as A,M as j,R as M,X as N,Z as P,bt as F,c as ee,q as te,t as ne}from"./css-DepZNlzm.js";import{t as I}from"./css-BaDt1NEF.js";import{n as L,t as R}from"./css-Yy0-Z0O_.js";import{t as z}from"./css-CyAko9J2.js";import{n as B,r as V}from"./vnode-CtRD2k6y.js";import{t as H}from"./message-CA9T8QLS.js";var U=N({border:Boolean,column:{type:Number,default:3},direction:{type:String,values:[`horizontal`,`vertical`],default:`horizontal`},size:te,title:{type:String,default:``},extra:{type:String,default:``},labelWidth:{type:[String,Number]}}),W=N({row:{type:P(Array),default:()=>[]}}),G=Symbol(`elDescriptions`),K=f({name:`ElDescriptionsCell`,props:{cell:{type:Object},tag:{type:String,default:`td`},type:{type:String}},setup(){return{descriptions:w(G,{})}},render(){var t,n,r,i;let a=V(this.cell),o=(((t=this.cell)==null?void 0:t.dirs)||[]).map(e=>{let{dir:t,arg:n,modifiers:r,value:i}=e;return[t,i,n,r]}),{border:s,direction:c}=this.descriptions,l=c===`vertical`,d=()=>{var e,t,n;return((n=(t=(e=this.cell)==null?void 0:e.children)==null?void 0:t.label)==null?void 0:n.call(t))||a.label},f=()=>{var e,t,n;return(n=(t=(e=this.cell)==null?void 0:e.children)==null?void 0:t.default)==null?void 0:n.call(t)},p=a.span,m=a.rowspan,h=a.align?`is-${a.align}`:``,g=a.labelAlign?`is-${a.labelAlign}`:h,_=a.className,v=a.labelClassName,y={width:j(this.type===`label`?(r=(n=a.labelWidth)==null?this.descriptions.labelWidth:n)==null?a.width:r:a.width),minWidth:j(a.minWidth)},b=F(`descriptions`);switch(this.type){case`label`:return u(e(this.tag,{style:y,class:[b.e(`cell`),b.e(`label`),b.is(`bordered-label`,s),b.is(`vertical-label`,l),g,v],colSpan:l?p:1,rowspan:l?1:m},d()),o);case`content`:return u(e(this.tag,{style:y,class:[b.e(`cell`),b.e(`content`),b.is(`bordered-content`,s),b.is(`vertical-content`,l),h,_],colSpan:l?p:p*2-1,rowspan:l?m*2-1:m},f()),o);default:{let t=d(),n={},r=j((i=a.labelWidth)==null?this.descriptions.labelWidth:i);return r&&(n.width=r,n.display=`inline-block`),u(e(`td`,{style:y,class:[b.e(`cell`),h],colSpan:p,rowspan:m},[k(t)?void 0:e(`span`,{style:n,class:[b.e(`label`),v]},t),e(`span`,{class:[b.e(`content`),_]},f())]),o)}}}}),q={key:1},J=f({name:`ElDescriptionsRow`,__name:`descriptions-row`,props:W,setup(e){let n=w(G,{});return(r,i)=>S(n).direction===`vertical`?(t(),_(d,{key:0},[p(`tr`,null,[(t(!0),_(d,null,a(e.row,(e,n)=>(t(),m(S(K),{key:`tr1-${n}`,cell:e,tag:`th`,type:`label`},null,8,[`cell`]))),128))]),p(`tr`,null,[(t(!0),_(d,null,a(e.row,(e,n)=>(t(),m(S(K),{key:`tr2-${n}`,cell:e,tag:`td`,type:`content`},null,8,[`cell`]))),128))])],64)):(t(),_(`tr`,q,[(t(!0),_(d,null,a(e.row,(e,r)=>(t(),_(d,{key:`tr3-${r}`},[S(n).border?(t(),_(d,{key:0},[T(S(K),{cell:e,tag:`td`,type:`label`},null,8,[`cell`]),T(S(K),{cell:e,tag:`td`,type:`content`},null,8,[`cell`])],64)):(t(),m(S(K),{key:1,cell:e,tag:`td`,type:`both`},null,8,[`cell`]))],64))),128))]))}}),Y=`ElDescriptionsItem`,X=f({name:`ElDescriptions`,__name:`description`,props:U,setup(e){let i=e,o=F(`descriptions`),l=ee(),u=n();r(G,i);let f=x(()=>[o.b(),o.m(l.value)]),h=(e,t,n,r=!1)=>(e.props||(e.props={}),t>n&&(e.props.span=n),r&&(e.props.span=t),e),v=()=>{if(!u.default)return[];let e=B(u.default()).filter(e=>{var t;return((t=e==null?void 0:e.type)==null?void 0:t.name)===Y}),t=[],n=[],r=i.column,a=0,o=[];return e.forEach((s,c)=>{var l,u,d;let f=((l=s.props)==null?void 0:l.span)||1,p=((u=s.props)==null?void 0:u.rowspan)||1,m=t.length;if(o[m]||(o[m]=0),p>1)for(let e=1;e<p;e++)o[d=m+e]||(o[d]=0),o[m+e]++,a++;if(o[m]>0&&(r-=o[m],o[m]=0),c<e.length-1&&(a+=f>r?r:f),c===e.length-1){let e=i.column-a%i.column;n.push(h(s,e,r,!0)),t.push(n);return}f<r?(r-=f,n.push(s)):(n.push(h(s,f,r)),t.push(n),r=i.column,n=[])}),t};return(n,r)=>(t(),_(`div`,{class:g(f.value)},[e.title||e.extra||n.$slots.title||n.$slots.extra?(t(),_(`div`,{key:0,class:g(S(o).e(`header`))},[p(`div`,{class:g(S(o).e(`title`))},[c(n.$slots,`title`,{},()=>[C(s(e.title),1)])],2),p(`div`,{class:g(S(o).e(`extra`))},[c(n.$slots,`extra`,{},()=>[C(s(e.extra),1)])],2)],2)):y(`v-if`,!0),p(`div`,{class:g(S(o).e(`body`))},[p(`table`,{class:g([S(o).e(`table`),S(o).is(`bordered`,e.border)])},[p(`tbody`,null,[(t(!0),_(d,null,a(v(),(e,n)=>(t(),m(J,{key:n,row:e},null,8,[`row`]))),128))])],2)],2)],2))}}),Z=[`left`,`center`,`right`],Q=f({name:Y,props:N({label:{type:String,default:``},span:{type:Number,default:1},rowspan:{type:Number,default:1},width:{type:[String,Number],default:``},minWidth:{type:[String,Number],default:``},labelWidth:{type:[String,Number]},align:{type:String,values:Z,default:`left`},labelAlign:{type:String,values:Z},className:{type:String,default:``},labelClassName:{type:String,default:``}})}),re=A(X,{DescriptionsItem:Q}),ie=M(Q);function ae(){return E.get(`/api/user/profile/current`)}function oe(e){return E.put(`/api/user/profile/current`,e)}var $={class:`profile-grid`},se={class:`glass-card card`},ce=[`src`],le={class:`muted`},ue={class:`glass-card card wide`},de={class:`glass-card card`},fe=b(f({__name:`ProfileView`,setup(e){let n=h(!1),r=h(!1),a=h(``),c=h(!1),u=v({nickname:``,email:``,phone:``,avatarUrl:``}),d=x(()=>{var e;return((e=O.user)==null?void 0:e.username)||`Unknown`}),f=x(()=>{var e;return((e=O.user)==null?void 0:e.userType)||`Unknown`}),g=x(()=>{if(u.avatarUrl.trim()&&!c.value)return u.avatarUrl.trim();let e=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 120">
    <defs><linearGradient id="g" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#1a3f9e"/><stop offset="100%" stop-color="#58a0ff"/></linearGradient></defs>
    <rect width="120" height="120" rx="30" fill="url(#g)"/>
    <circle cx="60" cy="46" r="18" fill="#fff" fill-opacity=".9"/>
    <path d="M24 99c4-18 20-30 36-30s32 12 36 30" fill="#fff" fill-opacity=".9"/>
    <text x="60" y="109" text-anchor="middle" font-size="18" font-family="Avenir, 'PingFang SC', sans-serif" fill="#eef5ff">${(u.nickname.trim()[0]||d.value[0]||`U`).toUpperCase()}</text>
  </svg>`;return`data:image/svg+xml;base64,${window.btoa(unescape(encodeURIComponent(e)))}`});function b(e){e&&(u.nickname=e.nickname||``,u.email=e.email||``,u.phone=e.phone||``,u.avatarUrl=e.avatarUrl||``)}async function S(){n.value=!0,a.value=``,b(O.user);try{let e=await ae();b(e),D({nickname:e.nickname,email:e.email,phone:e.phone,avatarUrl:e.avatarUrl})}catch(e){a.value=e instanceof Error?e.message:`Profile API is unavailable through gateway.`}finally{n.value=!1}}async function w(){r.value=!0;try{await oe({nickname:u.nickname,email:u.email,phone:u.phone,avatarUrl:u.avatarUrl}),D({nickname:u.nickname,email:u.email,phone:u.phone,avatarUrl:u.avatarUrl}),H.success(`Profile updated.`)}catch(e){let t=e instanceof Error?e.message:`Profile update failed`;H.error(t)}finally{r.value=!1}}o(()=>{S()}),i(()=>u.avatarUrl,()=>{c.value=!1});function E(){c.value=!0}return(e,i)=>{let o=ne,c=z,h=I,v=L,b=R,x=ie,D=re;return t(),_(`div`,$,[p(`section`,se,[i[5]||(i[5]=p(`p`,{class:`label`},`Current account`,-1)),p(`img`,{class:`avatar`,src:g.value,alt:`Profile avatar`,onError:E},null,40,ce),p(`h3`,null,s(d.value),1),p(`p`,le,`Role: `+s(f.value),1),T(o,{loading:n.value,round:``,type:`primary`,onClick:S},{default:l(()=>[...i[4]||(i[4]=[C(`Reload Profile`,-1)])]),_:1},8,[`loading`])]),p(`section`,ue,[i[7]||(i[7]=p(`p`,{class:`label`},`Profile settings`,-1)),a.value?(t(),m(c,{key:0,closable:!1,"show-icon":``,type:`warning`,title:a.value},null,8,[`title`])):y(``,!0),T(b,{class:`form`,"label-position":`top`},{default:l(()=>[T(v,{label:`Nickname`},{default:l(()=>[T(h,{modelValue:u.nickname,"onUpdate:modelValue":i[0]||(i[0]=e=>u.nickname=e)},null,8,[`modelValue`])]),_:1}),T(v,{label:`Email`},{default:l(()=>[T(h,{modelValue:u.email,"onUpdate:modelValue":i[1]||(i[1]=e=>u.email=e)},null,8,[`modelValue`])]),_:1}),T(v,{label:`Phone`},{default:l(()=>[T(h,{modelValue:u.phone,"onUpdate:modelValue":i[2]||(i[2]=e=>u.phone=e)},null,8,[`modelValue`])]),_:1}),T(v,{label:`Avatar URL`},{default:l(()=>[T(h,{modelValue:u.avatarUrl,"onUpdate:modelValue":i[3]||(i[3]=e=>u.avatarUrl=e)},null,8,[`modelValue`])]),_:1})]),_:1}),T(o,{loading:r.value,round:``,type:`primary`,onClick:w},{default:l(()=>[...i[6]||(i[6]=[C(`Save Profile`,-1)])]),_:1},8,[`loading`])]),p(`section`,de,[i[11]||(i[11]=p(`p`,{class:`label`},`Platform status`,-1)),T(D,{column:1,border:``},{default:l(()=>[T(x,{label:`Web`},{default:l(()=>[...i[8]||(i[8]=[C(`Ready`,-1)])]),_:1}),T(x,{label:`Android`},{default:l(()=>[...i[9]||(i[9]=[C(`Capacitor Ready`,-1)])]),_:1}),T(x,{label:`iOS`},{default:l(()=>[...i[10]||(i[10]=[C(`Capacitor Ready`,-1)])]),_:1})]),_:1})])])}}}),[[`__scopeId`,`data-v-af1f0f1b`]]);export{fe as default};