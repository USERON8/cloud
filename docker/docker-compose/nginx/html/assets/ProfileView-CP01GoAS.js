import{Ct as e,I as t,M as n,R as r,X as i,Z as a,bt as o,c as s,q as c,t as l}from"./css-gYsclK9r.js";import{C as u,F as d,G as f,I as p,J as m,L as h,M as g,Nt as _,R as v,X as y,Z as b,a as x,b as S,d as C,f as w,it as T,jt as E,m as D,nt as O,p as k,t as A,u as j,ut as M,v as N,w as P,y as F}from"./_plugin-vue_export-helper-CS_DzLMV.js";import{o as I,s as L}from"./session-ki_suUwh.js";import{t as R}from"./css-PREK1Btt.js";import{n as z,t as B}from"./css-BtLmholR.js";import{t as V}from"./css-B4r8G6Fv.js";import{n as H,r as U}from"./vnode-IUMfc0BT.js";import{t as W}from"./message-DyMrUQQL.js";import{t as G}from"./http-CgWw7_UJ.js";var K=i({border:Boolean,column:{type:Number,default:3},direction:{type:String,values:[`horizontal`,`vertical`],default:`horizontal`},size:c,title:{type:String,default:``},extra:{type:String,default:``},labelWidth:{type:[String,Number]}}),q=i({row:{type:a(Array),default:()=>[]}}),J=Symbol(`elDescriptions`),Y=S({name:`ElDescriptionsCell`,props:{cell:{type:Object},tag:{type:String,default:`td`},type:{type:String}},setup(){return{descriptions:P(J,{})}},render(){var t,r,i,a;let s=U(this.cell),c=(((t=this.cell)==null?void 0:t.dirs)||[]).map(e=>{let{dir:t,arg:n,modifiers:r,value:i}=e;return[t,i,n,r]}),{border:l,direction:d}=this.descriptions,f=d===`vertical`,p=()=>{var e,t,n;return((n=(t=(e=this.cell)==null?void 0:e.children)==null?void 0:t.label)==null?void 0:n.call(t))||s.label},m=()=>{var e,t,n;return(n=(t=(e=this.cell)==null?void 0:e.children)==null?void 0:t.default)==null?void 0:n.call(t)},h=s.span,g=s.rowspan,_=s.align?`is-${s.align}`:``,v=s.labelAlign?`is-${s.labelAlign}`:_,y=s.className,x=s.labelClassName,S={width:n(this.type===`label`?(i=(r=s.labelWidth)==null?this.descriptions.labelWidth:r)==null?s.width:i:s.width),minWidth:n(s.minWidth)},C=o(`descriptions`);switch(this.type){case`label`:return b(u(this.tag,{style:S,class:[C.e(`cell`),C.e(`label`),C.is(`bordered-label`,l),C.is(`vertical-label`,f),v,x],colSpan:f?h:1,rowspan:f?1:g},p()),c);case`content`:return b(u(this.tag,{style:S,class:[C.e(`cell`),C.e(`content`),C.is(`bordered-content`,l),C.is(`vertical-content`,f),_,y],colSpan:f?h:h*2-1,rowspan:f?g*2-1:g},m()),c);default:{let t=p(),r={},i=n((a=s.labelWidth)==null?this.descriptions.labelWidth:a);return i&&(r.width=i,r.display=`inline-block`),b(u(`td`,{style:S,class:[C.e(`cell`),_],colSpan:h,rowspan:g},[e(t)?void 0:u(`span`,{style:r,class:[C.e(`label`),x]},t),u(`span`,{class:[C.e(`content`),y]},m())]),c)}}}}),X={key:1},ee=S({name:`ElDescriptionsRow`,__name:`descriptions-row`,props:q,setup(e){let t=P(J,{});return(n,r)=>M(t).direction===`vertical`?(d(),D(x,{key:0},[C(`tr`,null,[(d(!0),D(x,null,h(e.row,(e,t)=>(d(),w(M(Y),{key:`tr1-${t}`,cell:e,tag:`th`,type:`label`},null,8,[`cell`]))),128))]),C(`tr`,null,[(d(!0),D(x,null,h(e.row,(e,t)=>(d(),w(M(Y),{key:`tr2-${t}`,cell:e,tag:`td`,type:`content`},null,8,[`cell`]))),128))])],64)):(d(),D(`tr`,X,[(d(!0),D(x,null,h(e.row,(e,n)=>(d(),D(x,{key:`tr3-${n}`},[M(t).border?(d(),D(x,{key:0},[F(M(Y),{cell:e,tag:`td`,type:`label`},null,8,[`cell`]),F(M(Y),{cell:e,tag:`td`,type:`content`},null,8,[`cell`])],64)):(d(),w(M(Y),{key:1,cell:e,tag:`td`,type:`both`},null,8,[`cell`]))],64))),128))]))}}),Z=`ElDescriptionsItem`,te=S({name:`ElDescriptions`,__name:`description`,props:K,setup(e){let t=e,n=o(`descriptions`),r=s(),i=f();p(J,t);let a=j(()=>[n.b(),n.m(r.value)]),c=(e,t,n,r=!1)=>(e.props||(e.props={}),t>n&&(e.props.span=n),r&&(e.props.span=t),e),l=()=>{if(!i.default)return[];let e=H(i.default()).filter(e=>{var t;return((t=e==null?void 0:e.type)==null?void 0:t.name)===Z}),n=[],r=[],a=t.column,o=0,s=[];return e.forEach((i,l)=>{var u,d,f;let p=((u=i.props)==null?void 0:u.span)||1,m=((d=i.props)==null?void 0:d.rowspan)||1,h=n.length;if(s[h]||(s[h]=0),m>1)for(let e=1;e<m;e++)s[f=h+e]||(s[f]=0),s[h+e]++,o++;if(s[h]>0&&(a-=s[h],s[h]=0),l<e.length-1&&(o+=p>a?a:p),l===e.length-1){let e=t.column-o%t.column;r.push(c(i,e,a,!0)),n.push(r);return}p<a?(a-=p,r.push(i)):(r.push(c(i,p,a)),n.push(r),a=t.column,r=[])}),n};return(t,r)=>(d(),D(`div`,{class:E(a.value)},[e.title||e.extra||t.$slots.title||t.$slots.extra?(d(),D(`div`,{key:0,class:E(M(n).e(`header`))},[C(`div`,{class:E(M(n).e(`title`))},[v(t.$slots,`title`,{},()=>[N(_(e.title),1)])],2),C(`div`,{class:E(M(n).e(`extra`))},[v(t.$slots,`extra`,{},()=>[N(_(e.extra),1)])],2)],2)):k(`v-if`,!0),C(`div`,{class:E(M(n).e(`body`))},[C(`table`,{class:E([M(n).e(`table`),M(n).is(`bordered`,e.border)])},[C(`tbody`,null,[(d(!0),D(x,null,h(l(),(e,t)=>(d(),w(ee,{key:t,row:e},null,8,[`row`]))),128))])],2)],2)],2))}}),Q=[`left`,`center`,`right`],$=S({name:Z,props:i({label:{type:String,default:``},span:{type:Number,default:1},rowspan:{type:Number,default:1},width:{type:[String,Number],default:``},minWidth:{type:[String,Number],default:``},labelWidth:{type:[String,Number]},align:{type:String,values:Q,default:`left`},labelAlign:{type:String,values:Q},className:{type:String,default:``},labelClassName:{type:String,default:``}})}),ne=t(te,{DescriptionsItem:$}),re=r($);function ie(){return G.get(`/api/user/profile/current`)}function ae(e){return G.put(`/api/user/profile/current`,e)}var oe={class:`profile-grid`},se={class:`glass-card card`},ce=[`src`],le={class:`muted`},ue={class:`glass-card card wide`},de={class:`glass-card card`},fe=A(S({__name:`ProfileView`,setup(e){let t=T(!1),n=T(!1),r=T(``),i=T(!1),a=O({nickname:``,email:``,phone:``,avatarUrl:``}),o=j(()=>{var e;return((e=L.user)==null?void 0:e.username)||`Unknown`}),s=j(()=>{var e;return((e=L.user)==null?void 0:e.userType)||`Unknown`}),c=j(()=>{if(a.avatarUrl.trim()&&!i.value)return a.avatarUrl.trim();let e=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 120">
    <defs><linearGradient id="g" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#1a3f9e"/><stop offset="100%" stop-color="#58a0ff"/></linearGradient></defs>
    <rect width="120" height="120" rx="30" fill="url(#g)"/>
    <circle cx="60" cy="46" r="18" fill="#fff" fill-opacity=".9"/>
    <path d="M24 99c4-18 20-30 36-30s32 12 36 30" fill="#fff" fill-opacity=".9"/>
    <text x="60" y="109" text-anchor="middle" font-size="18" font-family="Avenir, 'PingFang SC', sans-serif" fill="#eef5ff">${(a.nickname.trim()[0]||o.value[0]||`U`).toUpperCase()}</text>
  </svg>`;return`data:image/svg+xml;base64,${window.btoa(unescape(encodeURIComponent(e)))}`});function u(e){e&&(a.nickname=e.nickname||``,a.email=e.email||``,a.phone=e.phone||``,a.avatarUrl=e.avatarUrl||``)}async function f(){t.value=!0,r.value=``,u(L.user);try{let e=await ie();u(e),I({nickname:e.nickname,email:e.email,phone:e.phone,avatarUrl:e.avatarUrl})}catch(e){r.value=e instanceof Error?e.message:`Profile API is unavailable through gateway.`}finally{t.value=!1}}async function p(){n.value=!0;try{await ae({nickname:a.nickname,email:a.email,phone:a.phone,avatarUrl:a.avatarUrl}),I({nickname:a.nickname,email:a.email,phone:a.phone,avatarUrl:a.avatarUrl}),W.success(`Profile updated.`)}catch(e){let t=e instanceof Error?e.message:`Profile update failed`;W.error(t)}finally{n.value=!1}}g(()=>{f()}),m(()=>a.avatarUrl,()=>{i.value=!1});function h(){i.value=!0}return(e,i)=>{let u=l,m=V,g=R,v=z,b=B,x=re,S=ne;return d(),D(`div`,oe,[C(`section`,se,[i[5]||(i[5]=C(`p`,{class:`label`},`Current account`,-1)),C(`img`,{class:`avatar`,src:c.value,alt:`Profile avatar`,onError:h},null,40,ce),C(`h3`,null,_(o.value),1),C(`p`,le,`Role: `+_(s.value),1),F(u,{loading:t.value,round:``,type:`primary`,onClick:f},{default:y(()=>[...i[4]||(i[4]=[N(`Reload Profile`,-1)])]),_:1},8,[`loading`])]),C(`section`,ue,[i[7]||(i[7]=C(`p`,{class:`label`},`Profile settings`,-1)),r.value?(d(),w(m,{key:0,closable:!1,"show-icon":``,type:`warning`,title:r.value},null,8,[`title`])):k(``,!0),F(b,{class:`form`,"label-position":`top`},{default:y(()=>[F(v,{label:`Nickname`},{default:y(()=>[F(g,{modelValue:a.nickname,"onUpdate:modelValue":i[0]||(i[0]=e=>a.nickname=e)},null,8,[`modelValue`])]),_:1}),F(v,{label:`Email`},{default:y(()=>[F(g,{modelValue:a.email,"onUpdate:modelValue":i[1]||(i[1]=e=>a.email=e)},null,8,[`modelValue`])]),_:1}),F(v,{label:`Phone`},{default:y(()=>[F(g,{modelValue:a.phone,"onUpdate:modelValue":i[2]||(i[2]=e=>a.phone=e)},null,8,[`modelValue`])]),_:1}),F(v,{label:`Avatar URL`},{default:y(()=>[F(g,{modelValue:a.avatarUrl,"onUpdate:modelValue":i[3]||(i[3]=e=>a.avatarUrl=e)},null,8,[`modelValue`])]),_:1})]),_:1}),F(u,{loading:n.value,round:``,type:`primary`,onClick:p},{default:y(()=>[...i[6]||(i[6]=[N(`Save Profile`,-1)])]),_:1},8,[`loading`])]),C(`section`,de,[i[11]||(i[11]=C(`p`,{class:`label`},`Platform status`,-1)),F(S,{column:1,border:``},{default:y(()=>[F(x,{label:`Web`},{default:y(()=>[...i[8]||(i[8]=[N(`Ready`,-1)])]),_:1}),F(x,{label:`Android`},{default:y(()=>[...i[9]||(i[9]=[N(`Capacitor Ready`,-1)])]),_:1}),F(x,{label:`iOS`},{default:y(()=>[...i[10]||(i[10]=[N(`Capacitor Ready`,-1)])]),_:1})]),_:1})])])}}}),[[`__scopeId`,`data-v-af1f0f1b`]]);export{fe as default};