import{Ct as e,I as t,M as n,R as r,X as i,Z as a,bt as o,c as s,q as c,t as l}from"./css-E3i9oLPS.js";import{At as u,C as d,F as f,I as p,L as m,Mt as h,P as g,S as _,W as v,X as y,Y as b,_ as x,a as S,d as C,f as w,j as T,lt as E,m as D,p as O,rt as k,t as A,tt as j,u as M,v as N,y as P}from"./_plugin-vue_export-helper-Db-PtwND.js";import{o as F}from"./session-C5oAodxY.js";import{t as I}from"./css-BuQUL2TQ.js";import{n as L,t as R}from"./css-BsJVaiF6.js";import{t as z}from"./css-CprhpbK2.js";import{n as ee,r as B}from"./vnode-D3yQ9d8z.js";import{t as V}from"./message-CbR1IZY7.js";import{t as H}from"./http-D8xhHfNR.js";var U=i({border:Boolean,column:{type:Number,default:3},direction:{type:String,values:[`horizontal`,`vertical`],default:`horizontal`},size:c,title:{type:String,default:``},extra:{type:String,default:``},labelWidth:{type:[String,Number]}}),W=i({row:{type:a(Array),default:()=>[]}}),G=Symbol(`elDescriptions`),K=P({name:`ElDescriptionsCell`,props:{cell:{type:Object},tag:{type:String,default:`td`},type:{type:String}},setup(){return{descriptions:d(G,{})}},render(){var t,r,i,a;let s=B(this.cell),c=(((t=this.cell)==null?void 0:t.dirs)||[]).map(e=>{let{dir:t,arg:n,modifiers:r,value:i}=e;return[t,i,n,r]}),{border:l,direction:u}=this.descriptions,d=u===`vertical`,f=()=>{var e,t,n;return((n=(t=(e=this.cell)==null?void 0:e.children)==null?void 0:t.label)==null?void 0:n.call(t))||s.label},p=()=>{var e,t,n;return(n=(t=(e=this.cell)==null?void 0:e.children)==null?void 0:t.default)==null?void 0:n.call(t)},m=s.span,h=s.rowspan,g=s.align?`is-${s.align}`:``,v=s.labelAlign?`is-${s.labelAlign}`:g,b=s.className,x=s.labelClassName,S={width:n(this.type===`label`?(i=(r=s.labelWidth)==null?this.descriptions.labelWidth:r)==null?s.width:i:s.width),minWidth:n(s.minWidth)},C=o(`descriptions`);switch(this.type){case`label`:return y(_(this.tag,{style:S,class:[C.e(`cell`),C.e(`label`),C.is(`bordered-label`,l),C.is(`vertical-label`,d),v,x],colSpan:d?m:1,rowspan:d?1:h},f()),c);case`content`:return y(_(this.tag,{style:S,class:[C.e(`cell`),C.e(`content`),C.is(`bordered-content`,l),C.is(`vertical-content`,d),g,b],colSpan:d?m:m*2-1,rowspan:d?h*2-1:h},p()),c);default:{let t=f(),r={},i=n((a=s.labelWidth)==null?this.descriptions.labelWidth:a);return i&&(r.width=i,r.display=`inline-block`),y(_(`td`,{style:S,class:[C.e(`cell`),g],colSpan:m,rowspan:h},[e(t)?void 0:_(`span`,{style:r,class:[C.e(`label`),x]},t),_(`span`,{class:[C.e(`content`),b]},p())]),c)}}}}),q={key:1},J=P({name:`ElDescriptionsRow`,__name:`descriptions-row`,props:W,setup(e){let t=d(G,{});return(n,r)=>E(t).direction===`vertical`?(g(),D(S,{key:0},[C(`tr`,null,[(g(!0),D(S,null,p(e.row,(e,t)=>(g(),w(E(K),{key:`tr1-${t}`,cell:e,tag:`th`,type:`label`},null,8,[`cell`]))),128))]),C(`tr`,null,[(g(!0),D(S,null,p(e.row,(e,t)=>(g(),w(E(K),{key:`tr2-${t}`,cell:e,tag:`td`,type:`content`},null,8,[`cell`]))),128))])],64)):(g(),D(`tr`,q,[(g(!0),D(S,null,p(e.row,(e,n)=>(g(),D(S,{key:`tr3-${n}`},[E(t).border?(g(),D(S,{key:0},[N(E(K),{cell:e,tag:`td`,type:`label`},null,8,[`cell`]),N(E(K),{cell:e,tag:`td`,type:`content`},null,8,[`cell`])],64)):(g(),w(E(K),{key:1,cell:e,tag:`td`,type:`both`},null,8,[`cell`]))],64))),128))]))}}),Y=`ElDescriptionsItem`,X=P({name:`ElDescriptions`,__name:`description`,props:U,setup(e){let t=e,n=o(`descriptions`),r=s(),i=v();f(G,t);let a=M(()=>[n.b(),n.m(r.value)]),c=(e,t,n,r=!1)=>(e.props||(e.props={}),t>n&&(e.props.span=n),r&&(e.props.span=t),e),l=()=>{if(!i.default)return[];let e=ee(i.default()).filter(e=>{var t;return((t=e==null?void 0:e.type)==null?void 0:t.name)===Y}),n=[],r=[],a=t.column,o=0,s=[];return e.forEach((i,l)=>{var u,d,f;let p=((u=i.props)==null?void 0:u.span)||1,m=((d=i.props)==null?void 0:d.rowspan)||1,h=n.length;if(s[h]||(s[h]=0),m>1)for(let e=1;e<m;e++)s[f=h+e]||(s[f]=0),s[h+e]++,o++;if(s[h]>0&&(a-=s[h],s[h]=0),l<e.length-1&&(o+=p>a?a:p),l===e.length-1){let e=t.column-o%t.column;r.push(c(i,e,a,!0)),n.push(r);return}p<a?(a-=p,r.push(i)):(r.push(c(i,p,a)),n.push(r),a=t.column,r=[])}),n};return(t,r)=>(g(),D(`div`,{class:u(a.value)},[e.title||e.extra||t.$slots.title||t.$slots.extra?(g(),D(`div`,{key:0,class:u(E(n).e(`header`))},[C(`div`,{class:u(E(n).e(`title`))},[m(t.$slots,`title`,{},()=>[x(h(e.title),1)])],2),C(`div`,{class:u(E(n).e(`extra`))},[m(t.$slots,`extra`,{},()=>[x(h(e.extra),1)])],2)],2)):O(`v-if`,!0),C(`div`,{class:u(E(n).e(`body`))},[C(`table`,{class:u([E(n).e(`table`),E(n).is(`bordered`,e.border)])},[C(`tbody`,null,[(g(!0),D(S,null,p(l(),(e,t)=>(g(),w(J,{key:t,row:e},null,8,[`row`]))),128))])],2)],2)],2))}}),Z=[`left`,`center`,`right`],Q=P({name:Y,props:i({label:{type:String,default:``},span:{type:Number,default:1},rowspan:{type:Number,default:1},width:{type:[String,Number],default:``},minWidth:{type:[String,Number],default:``},labelWidth:{type:[String,Number]},align:{type:String,values:Z,default:`left`},labelAlign:{type:String,values:Z},className:{type:String,default:``},labelClassName:{type:String,default:``}})}),te=t(X,{DescriptionsItem:Q}),ne=r(Q);function re(){return H.get(`/api/user/profile/current`)}function ie(e){return H.put(`/api/user/profile/current`,e)}var ae={class:`profile-grid`},oe={class:`glass-card card`},$={class:`muted`},se={class:`glass-card card wide`},ce={class:`glass-card card`},le=A(P({__name:`ProfileView`,setup(e){let t=k(!1),n=k(!1),r=k(``),i=j({nickname:``,email:``,phone:``,avatarUrl:``}),a=M(()=>{var e;return((e=F.user)==null?void 0:e.username)||`Unknown`}),o=M(()=>{var e;return((e=F.user)==null?void 0:e.userType)||`Unknown`});function s(e){e&&(i.nickname=e.nickname||``,i.email=e.email||``,i.phone=e.phone||``,i.avatarUrl=e.avatarUrl||``)}async function c(){t.value=!0,r.value=``,s(F.user);try{s(await re())}catch(e){r.value=e instanceof Error?e.message:`Profile API is unavailable through gateway.`}finally{t.value=!1}}async function u(){n.value=!0;try{await ie({nickname:i.nickname,email:i.email,phone:i.phone,avatarUrl:i.avatarUrl}),V.success(`Profile updated.`)}catch(e){let t=e instanceof Error?e.message:`Profile update failed`;V.error(t)}finally{n.value=!1}}return T(()=>{c()}),(e,s)=>{let d=l,f=z,p=I,m=L,_=R,v=ne,y=te;return g(),D(`div`,ae,[C(`section`,oe,[s[5]||(s[5]=C(`p`,{class:`label`},`Current account`,-1)),C(`h3`,null,h(a.value),1),C(`p`,$,`Role: `+h(o.value),1),N(d,{loading:t.value,round:``,type:`primary`,onClick:c},{default:b(()=>[...s[4]||(s[4]=[x(`Reload Profile`,-1)])]),_:1},8,[`loading`])]),C(`section`,se,[s[7]||(s[7]=C(`p`,{class:`label`},`Profile settings`,-1)),r.value?(g(),w(f,{key:0,closable:!1,"show-icon":``,type:`warning`,title:r.value},null,8,[`title`])):O(``,!0),N(_,{class:`form`,"label-position":`top`},{default:b(()=>[N(m,{label:`Nickname`},{default:b(()=>[N(p,{modelValue:i.nickname,"onUpdate:modelValue":s[0]||(s[0]=e=>i.nickname=e)},null,8,[`modelValue`])]),_:1}),N(m,{label:`Email`},{default:b(()=>[N(p,{modelValue:i.email,"onUpdate:modelValue":s[1]||(s[1]=e=>i.email=e)},null,8,[`modelValue`])]),_:1}),N(m,{label:`Phone`},{default:b(()=>[N(p,{modelValue:i.phone,"onUpdate:modelValue":s[2]||(s[2]=e=>i.phone=e)},null,8,[`modelValue`])]),_:1}),N(m,{label:`Avatar URL`},{default:b(()=>[N(p,{modelValue:i.avatarUrl,"onUpdate:modelValue":s[3]||(s[3]=e=>i.avatarUrl=e)},null,8,[`modelValue`])]),_:1})]),_:1}),N(d,{loading:n.value,round:``,type:`primary`,onClick:u},{default:b(()=>[...s[6]||(s[6]=[x(`Save Profile`,-1)])]),_:1},8,[`loading`])]),C(`section`,ce,[s[11]||(s[11]=C(`p`,{class:`label`},`Platform status`,-1)),N(y,{column:1,border:``},{default:b(()=>[N(v,{label:`Web`},{default:b(()=>[...s[8]||(s[8]=[x(`Ready`,-1)])]),_:1}),N(v,{label:`Android`},{default:b(()=>[...s[9]||(s[9]=[x(`Capacitor Ready`,-1)])]),_:1}),N(v,{label:`iOS`},{default:b(()=>[...s[10]||(s[10]=[x(`Capacitor Ready`,-1)])]),_:1})]),_:1})])])}}}),[[`__scopeId`,`data-v-ac4d4b21`]]);export{le as default};