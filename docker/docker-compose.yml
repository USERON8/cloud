services:
  # ASCII comment sanitized for compatibility.
  mysql:
    image: mysql:9.3.0
    container_name: mysql_db
    networks:
      service_net:
        ipv4_address: 172.28.0.10
    environment:
      MYSQL_ROOT_PASSWORD: "root"
      MYSQL_DATABASE: nacos_config
      MYSQL_USER: nacos
      MYSQL_PASSWORD: "nacos"
    volumes:
      - type: bind
        source: ./docker-compose/mysql/data
        target: /var/lib/mysql
      - type: bind
        source: ./docker-compose/mysql/config
        target: /etc/mysql/conf.d
      - type: bind
        source: ./docker-compose/mysql/logs
        target: /var/log/mysql
      - type: bind
        source: ./docker-compose/mysql/init
        target: /docker-entrypoint-initdb.d
    ports:
      - "3306:3306"
    healthcheck:
      test: [ "CMD", "mysqladmin", "ping", "-h", "127.0.0.1" ]
      interval: 5s
      timeout: 10s
      retries: 10

  # ASCII comment sanitized for compatibility.
  redis:
    image: redis:7.4.5-bookworm
    container_name: redis_cache
    networks:
      service_net:
        ipv4_address: 172.28.0.20
    command: redis-server /usr/local/etc/redis/redis.conf --appendonly yes
    volumes:
      - type: bind
        source: ./docker-compose/redis/data
        target: /data
      - type: bind
        source: ./docker-compose/redis/conf
        target: /usr/local/etc/redis
      - type: bind
        source: ./docker-compose/redis/logs
        target: /var/log/redis
    ports:
      - "6379:6379"
    healthcheck:
      test: [ "CMD-SHELL", "redis-cli -a root ping | grep PONG" ]
      interval: 5s
      timeout: 5s
      retries: 5

  # ASCII comment sanitized for compatibility.
  nacos:
    image: nacos/nacos-server:v3.0.2
    container_name: nacos_server
    networks:
      service_net:
        ipv4_address: 172.28.0.30
    environment:
      MODE: standalone
      NACOS_SERVER_IP: 172.28.0.30

      SPRING_DATASOURCE_PLATFORM: mysql
      MYSQL_SERVICE_HOST: 172.28.0.10
      MYSQL_SERVICE_PORT: 3306
      MYSQL_SERVICE_DB_NAME: nacos_config
      MYSQL_SERVICE_USER: nacos
      MYSQL_SERVICE_PASSWORD: nacos
      MYSQL_DATABASE_NUM: 1
      MYSQL_SERVICE_DB_PARAM: "characterEncoding=utf8&connectTimeout=1000&socketTimeout=3000&autoReconnect=true&useSSL=false"

      # ASCII comment sanitized for compatibility.
      NACOS_SERVER_CONTEXTPATH: /nacos  # ASCII comment sanitized for compatibility.
      NACOS_CONSOLE_CONTEXTPATH: /nacos  # ASCII comment sanitized for compatibility.
      NACOS_CONSOLE_REMOTE_SERVER_CONTEXT_PATH: /nacos  # ASCII comment sanitized for compatibility.

      # ASCII comment sanitized for compatibility.
      NACOS_AUTH_ENABLE: "true"  # ASCII comment sanitized for compatibility.
      NACOS_AUTH_IDENTITY_KEY: ServerIdentity_Key  # ASCII comment sanitized for compatibility.
      NACOS_AUTH_IDENTITY_VALUE: ServerIdentity_Value_123
      NACOS_AUTH_TOKEN: VGhpc0lzTXlDdXN0b21TZWNyZXRLZXkwMTIzNDU2Nzg=  # ASCII comment sanitized for compatibility.
      NACOS_SECURITY_IGNORE_URLS: "/,/error,/**/*.css,/**/*.js,/**/*.html,/**/*.map,/**/*.svg,/**/*.png,/**/*.ico,/console-ui/public/**,/v1/auth/**,/v1/console/health/**,/actuator/**,/v1/console/server/**"  # ASCII comment sanitized for compatibility.

      # ASCII comment sanitized for compatibility.
      NACOS_SECURITY_ADMIN_USER: root  # ASCII comment sanitized for compatibility.
      NACOS_SECURITY_ADMIN_PASSWORD: root

      # ASCII comment sanitized for compatibility.
      NACOS_CORE_AUTH_DEFAULT_ROLES: ADMIN
      NACOS_CORE_AUTH_DEFAULT_RESOURCE: "public:*:*"
      # ASCII comment sanitized for compatibility.
      JVM_XMS: 512m
      JVM_XMX: 512m
      NACOS_NAMING_EMPTY_SERVICE_AUTO_CLEAN: "true"

    ports:
      - "8848:8848"
      - "9090:9090"
      - "9848:9848"
    volumes:
      - type: bind
        source: ./docker-compose/nacos/logs
        target: /home/nacos/logs
      - type: bind
        source: ./docker-compose/nacos/conf
        target: /home/nacos/conf
      - type: bind
        source: ./docker-compose/nacos/data
        target: /home/nacos/data
    depends_on:
      mysql:
        condition: service_healthy
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://127.0.0.1:9090/nacos/" ]
      interval: 10s
      timeout: 5s
      retries: 12
  # ASCII comment sanitized for compatibility.
  namesrv:
    image: apache/rocketmq:5.3.2
    container_name: rmqnamesrv
    networks:
      service_net:
        ipv4_address: 172.28.0.40
    ports:
      - "39876:9876"  # ASCII comment sanitized for compatibility.
    volumes:
      - type: bind
        source: ./docker-compose/rocketmq/namesrv/logs
        target: /home/rocketmq/namesrv/logs
      - type: bind
        source: ./docker-compose/rocketmq/namesrv/store
        target: /home/rocketmq/namesrv/store
    environment:
      - NAMESRV_ADDR=172.28.0.40:9876
    command: sh mqnamesrv
  # ASCII comment sanitized for compatibility.
  broker:
    image: apache/rocketmq:5.3.2
    container_name: rmqbroker
    networks:
      service_net:
        ipv4_address: 172.28.0.50
    depends_on:
      - namesrv
    ports:
      - "30909:10909"  # ASCII comment sanitized for compatibility.
      - "30911:10911"  # ASCII comment sanitized for compatibility.
      - "30912:10912"  # ASCII comment sanitized for compatibility.
      - "38080:8080"   # ASCII comment sanitized for compatibility.
      - "38081:8081"   # ASCII comment sanitized for compatibility.
    volumes:
      - type: bind
        source: ./docker-compose/rocketmq/broker/logs
        target: /home/rocketmq/logs
      - type: bind
        source: ./docker-compose/rocketmq/broker/store
        target: /home/rocketmq/store
      - type: bind
        source: ./docker-compose/rocketmq/broker/conf
        target: /home/rocketmq/conf
    environment:
      - NAMESRV_ADDR=172.28.0.40:9876
    # ASCII comment sanitized for compatibility.
    command: sh mqbroker -n 172.28.0.40:9876 --enable-proxy -c /home/rocketmq/conf/broker.conf

  # ASCII comment sanitized for compatibility.
  rmq-console:
    image: apacherocketmq/rocketmq-dashboard:2.1.0
    container_name: rmq-console
    networks:
      service_net:
        ipv4_address: 172.28.0.65
    depends_on:
      - namesrv
    ports:
      - "38082:8082"
    environment:
      JAVA_OPTS: -Drocketmq.namesrv.addr=172.28.0.40:9876 -Dcom.rocketmq.sendMessageWithVIPChannel=false

  # ASCII comment sanitized for compatibility.
  nginx:
    image: nginx:stable-perl
    container_name: nginx_gateway
    networks:
      service_net:
        ipv4_address: 172.28.0.70
    ports:
      - "18080:80"      # ASCII comment sanitized for compatibility.
      - "18443:443"    # ASCII comment sanitized for compatibility.
    volumes:
      - type: bind
        source: ./docker-compose/nginx/config/nginx.conf
        target: /etc/nginx/nginx.conf
      - type: bind
        source: ./docker-compose/nginx/logs
        target: /var/log/nginx
      - type: bind
        source: ./docker-compose/nginx/html
        target: /usr/share/nginx/html
    depends_on:
      - nacos
  # ASCII comment sanitized for compatibility.
  minio:
    image: minio/minio:RELEASE.2025-07-23T15-54-02Z-cpuv1
    container_name: minio
    networks:
      service_net:
        ipv4_address: 172.28.0.80
    ports:
      - "9000:9000"
      - "9001:9001"
    environment:
      MINIO_ROOT_USER: minioadmin
      MINIO_ROOT_PASSWORD: minioadmin
    command: server /data --console-address ":9001"
    volumes:
      - type: bind
        source: ./docker-compose/minio/data
        target: /home/minio/data
  # ASCII comment sanitized for compatibility.
  elasticsearch:
    image: elasticsearch:9.1.2
    container_name: es_search
    networks:
      service_net:
        ipv4_address: 172.28.0.90  # ASCII comment sanitized for compatibility.
    environment:
      # ASCII comment sanitized for compatibility.
      - discovery.type=single-node  # ASCII comment sanitized for compatibility.
      - ES_JAVA_OPTS=-Xms1g -Xmx1g  # ASCII comment sanitized for compatibility.
      - bootstrap.memory_lock=true  # ASCII comment sanitized for compatibility.
      - xpack.security.enabled=false  # ASCII comment sanitized for compatibility.
      - http.cors.enabled=true
      - http.cors.allow-origin=" *"
    volumes:
      - type: bind
        source: ./docker-compose/elasticsearch/data
        target: /usr/share/elasticsearch/data
      - type: bind
        source: ./docker-compose/elasticsearch/plugins
        target: /usr/share/elasticsearch/plugins
    ports:
      - "9200:9200"  # ASCII comment sanitized for compatibility.
      - "9300:9300"  # ASCII comment sanitized for compatibility.
    ulimits: # ASCII comment sanitized for compatibility.
      memlock:
        soft: -1
        hard: -1
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://127.0.0.1:9200" ]
      interval: 10s
      timeout: 5s
      retries: 12
  # Kibana
  kibana:
    image: kibana:9.1.2
    container_name: kibana_es
    depends_on:
      - elasticsearch
    networks:
      service_net:
        ipv4_address: 172.28.0.100
    ports:
      - "5601:5601"
    environment:
      # ASCII comment sanitized for compatibility.
      - ELASTICSEARCH_HOSTS=http://elasticsearch:9200
      - SERVER_HOST=0.0.0.0
      - SERVER_NAME=kibana-service

      # ASCII comment sanitized for compatibility.
      - NODE_OPTIONS=--max-old-space-size=2048

      # ASCII comment sanitized for compatibility.
      - XPACK_APM_ENABLED=false
      - XPACK_INFRA_ENABLED=false
      - XPACK_MONITORING_UI_ENABLED=false
      - XPACK_OBSERVABILITY_ENABLED=false
      - TELEMETRY_ENABLED=false

      # ASCII comment sanitized for compatibility.
      - LOGGING_JSON_ENABLED=false
    volumes:
      - type: bind
        source: ./docker-compose/kibana/config
        target: /usr/share/kibana/config
        # ASCII comment sanitized for compatibility.
      - type: bind
        source: ./docker-compose/kibana/data
        target: /usr/share/kibana/data
    healthcheck: # ASCII comment sanitized for compatibility.
      test: [ "CMD", "curl", "-f", "http://127.0.0.1:5601/api/status" ]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 60s
# ASCII comment sanitized for compatibility.
networks:
  service_net:
    driver: bridge
    ipam:
      config:
        - subnet: 172.28.0.0/24
          gateway: 172.28.0.1

