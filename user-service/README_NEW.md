# ğŸ‘¥ User Service - ç”¨æˆ·æœåŠ¡

## ğŸ“‹ æœåŠ¡æ¦‚è¿°

ç”¨æˆ·æœåŠ¡æ˜¯Cloudå¾®æœåŠ¡ç”µå•†å¹³å°çš„æ ¸å¿ƒä¸šåŠ¡æœåŠ¡ï¼Œè´Ÿè´£ç®¡ç†ç”¨æˆ·ç›¸å…³çš„ä¸šåŠ¡é€»è¾‘ï¼ŒåŒ…æ‹¬ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€ä¸ªäººä¿¡æ¯ç®¡ç†ã€åœ°å€ç®¡ç†ç­‰åŠŸèƒ½ã€‚

**æœ€è¿‘æ›´æ–°æ—¶é—´**: 2025-01-25  
**å¼€å‘è¿›åº¦**: 90% âœ…  
**æœåŠ¡ç«¯å£**: 8082

### ğŸ”§ æŠ€æœ¯æ ˆç‰ˆæœ¬

- **Spring Boot**: 3.5.3
- **Spring Cloud**: 2025.0.0
- **MyBatis-Plus**: 3.5.13
- **MySQL**: 8.0+
- **Redis**: 7.0+
- **MapStruct**: 1.6.3
- **RocketMQ**: 5.3.2 (ç«¯å£39876)
- **OAuth2**: Spring Security OAuth2 Resource Server

## ğŸŒŸ æ ¸å¿ƒåŠŸèƒ½

### 1. ç”¨æˆ·ç®¡ç† âœ…
- **ç”¨æˆ·æ³¨å†Œ**: æ”¯æŒç”¨æˆ·å/é‚®ç®±æ³¨å†Œ
- **ç”¨æˆ·ç™»å½•**: å¤šç§ç™»å½•æ–¹å¼ï¼ˆç”¨æˆ·åã€é‚®ç®±ã€OAuthï¼‰
- **ä¿¡æ¯ç®¡ç†**: ç”¨æˆ·ä¿¡æ¯æŸ¥è¯¢ã€æ›´æ–°ã€çŠ¶æ€ç®¡ç†
- **å¤šçº§ç”¨æˆ·**: æ™®é€šç”¨æˆ·ã€å•†å®¶ã€ç®¡ç†å‘˜ä¸‰çº§ä½“ç³»

### 2. åœ°å€ç®¡ç† âœ…
- **åœ°å€CRUD**: æ·»åŠ ã€æŸ¥è¯¢ã€æ›´æ–°ã€åˆ é™¤ç”¨æˆ·åœ°å€
- **é»˜è®¤åœ°å€**: æ™ºèƒ½é»˜è®¤åœ°å€è®¾ç½®å’Œç®¡ç†
- **æƒé™æ§åˆ¶**: åŸºäºç”¨æˆ·èº«ä»½çš„åœ°å€è®¿é—®æ§åˆ¶
- **åˆ†é¡µæŸ¥è¯¢**: æ”¯æŒåœ°å€ä¿¡æ¯åˆ†é¡µæŸ¥è¯¢

### 3. OAuth2é›†æˆ âœ…
- **GitHub OAuth**: æ”¯æŒGitHubç¬¬ä¸‰æ–¹ç™»å½•
- **JWTè®¤è¯**: ä½œä¸ºOAuth2.1èµ„æºæœåŠ¡å™¨
- **æƒé™ç®¡ç†**: ç»†ç²’åº¦çš„æƒé™æ§åˆ¶æœºåˆ¶

### 4. äº‹ä»¶é©±åŠ¨ âœ…
- **ç”¨æˆ·äº‹ä»¶**: ç”¨æˆ·å˜æ›´äº‹ä»¶å‘å¸ƒ
- **æ—¥å¿—æ”¶é›†**: å¼‚æ­¥æ—¥å¿—äº‹ä»¶å‘é€
- **æ¶ˆæ¯å¯é æ€§**: é‡è¯•æœºåˆ¶å’Œæ­»ä¿¡é˜Ÿåˆ—

## ğŸš€ æœåŠ¡é…ç½®

### ç«¯å£ä¸æ•°æ®åº“
```yaml
server:
  port: 8082  # ç”¨æˆ·æœåŠ¡ç«¯å£

spring:
  datasource:
    url: jdbc:mysql://localhost:3306/user_db  # ç”¨æˆ·æ•°æ®åº“
    username: ${DB_USERNAME:root}
    password: ${DB_PASSWORD:root}
```

### RocketMQé…ç½®
```yaml
spring:
  cloud:
    stream:
      rocketmq:
        binder:
          name-server: 127.0.0.1:39876  # ç»Ÿä¸€ç«¯å£
```

### OAuth2é…ç½®
```yaml
spring:
  security:
    oauth2:
      resourceserver:
        jwt:
          jwk-set-uri: http://127.0.0.1:80/.well-known/jwks.json
```

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### æ•°æ®åº“ä¿¡æ¯
- **æ•°æ®åº“å**: `user_db` (ç¬¦åˆxx_dbå‘½åè§„èŒƒ)
- **å­—ç¬¦é›†**: utf8mb4
- **å­˜å‚¨å¼•æ“**: InnoDB

### ä¸»è¦è¡¨ç»“æ„
| è¡¨å | è¯´æ˜ | ä¸»è¦å­—æ®µ |
|------|------|----------|
| `users` | ç”¨æˆ·ä¸»è¡¨ | id, username, password, email, github_id |
| `user_address` | ç”¨æˆ·åœ°å€è¡¨ | id, user_id, consignee, phone, detail_address |
| `admin` | ç®¡ç†å‘˜è¡¨ | id, username, real_name, role |
| `merchant` | å•†å®¶è¡¨ | id, username, merchant_name, status |
| `merchant_auth` | å•†å®¶è®¤è¯è¡¨ | merchant_id, business_license, auth_status |

è¯¦ç»†è¡¨ç»“æ„è¯·å‚è€ƒ: [ç”¨æˆ·æ•°æ®åº“è®¾è®¡](../sql/init/initdb_user.sql)

## ğŸ”Œ APIæ¥å£

### ç”¨æˆ·ç®¡ç†æ¥å£
```
GET    /api/v1/user/{id}           # è·å–ç”¨æˆ·ä¿¡æ¯
PUT    /api/v1/user/{id}           # æ›´æ–°ç”¨æˆ·ä¿¡æ¯  
POST   /api/v1/user/register       # ç”¨æˆ·æ³¨å†Œ
POST   /api/v1/user/login          # ç”¨æˆ·ç™»å½•
POST   /api/v1/user/logout         # ç”¨æˆ·ç™»å‡º
```

### åœ°å€ç®¡ç†æ¥å£
```
GET    /user/address/list/{userId}        # è·å–åœ°å€åˆ—è¡¨
POST   /user/address/add/{userId}         # æ·»åŠ ç”¨æˆ·åœ°å€
PUT    /user/address/update/{addressId}   # æ›´æ–°åœ°å€ä¿¡æ¯
DELETE /user/address/delete/{addressId}  # åˆ é™¤ç”¨æˆ·åœ°å€
GET    /user/address/default/{userId}     # è·å–é»˜è®¤åœ°å€
POST   /user/address/page                 # åˆ†é¡µæŸ¥è¯¢åœ°å€
```

### æƒé™è¯´æ˜
- æ‰€æœ‰æ¥å£éœ€è¦JWTè®¤è¯
- ç”¨æˆ·åªèƒ½æ“ä½œè‡ªå·±çš„æ•°æ®
- ç®¡ç†å‘˜å¯ä»¥æ“ä½œæ‰€æœ‰æ•°æ®
- ä½¿ç”¨`SecurityPermissionUtils`è¿›è¡Œæƒé™æ£€æŸ¥

**APIæ–‡æ¡£åœ°å€**: http://localhost:8082/doc.html

## ğŸ”„ æ¶ˆæ¯é˜Ÿåˆ—è®¾è®¡

### ç”Ÿäº§è€…äº‹ä»¶
- **ç”¨æˆ·å˜æ›´äº‹ä»¶**: `user-events` topic
- **æ—¥å¿—æ”¶é›†äº‹ä»¶**: `log-collection-topic` topic

### æ¶ˆæ¯æ ¼å¼
```json
{
  "eventId": "uuid",
  "eventType": "USER_CREATED",
  "userId": 12345,
  "timestamp": "2025-01-25T10:30:00Z",
  "data": {
    "username": "testuser",
    "email": "test@example.com"
  }
}
```

## ğŸ“Š ç›‘æ§æŒ‡æ ‡

### ä¸šåŠ¡æŒ‡æ ‡
- ç”¨æˆ·æ³¨å†Œæ•°
- æ´»è·ƒç”¨æˆ·æ•°
- åœ°å€ç®¡ç†æ“ä½œæ•°
- OAuthç™»å½•æˆåŠŸç‡

### æŠ€æœ¯æŒ‡æ ‡
- æ¥å£å“åº”æ—¶é—´
- æ•°æ®åº“è¿æ¥æ± ä½¿ç”¨ç‡
- ç¼“å­˜å‘½ä¸­ç‡
- æ¶ˆæ¯é˜Ÿåˆ—æ¶ˆè´¹å»¶è¿Ÿ

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

### 1. æ•°æ®å®‰å…¨
- å¯†ç BCryptåŠ å¯†
- æ•æ„Ÿä¿¡æ¯è„±æ•
- SQLå‚æ•°åŒ–æŸ¥è¯¢

### 2. æ¥å£å®‰å…¨
- JWT TokenéªŒè¯
- ç»†ç²’åº¦æƒé™æ§åˆ¶
- è¯·æ±‚å‚æ•°æ ¡éªŒ
- é˜²é‡æ”¾æ”»å‡»

### 3. OAuthé›†æˆ
- GitHub OAuth2ç™»å½•
- PKCEå®‰å…¨å¢å¼º
- Tokenç”Ÿå‘½å‘¨æœŸç®¡ç†

## ğŸš€ éƒ¨ç½²è¯´æ˜

### ç¯å¢ƒè¦æ±‚
- JDK 17+
- MySQL 8.0+
- Redis 6.0+
- RocketMQ 5.3.2+
- Nacos 2.4.0+

### å¯åŠ¨å‘½ä»¤
```bash
# å¼€å‘ç¯å¢ƒ
java -jar target/user-service-0.0.1-SNAPSHOT.jar --spring.profiles.active=dev

# ç”Ÿäº§ç¯å¢ƒ
java -jar target/user-service-0.0.1-SNAPSHOT.jar \
  --spring.profiles.active=prod \
  --server.port=8082
```

### å¥åº·æ£€æŸ¥
```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
curl http://localhost:8082/actuator/health

# æ£€æŸ¥æœåŠ¡æ³¨å†Œ
curl http://localhost:8848/nacos/v1/ns/instance/list?serviceName=user-service
```

## ğŸ”§ å¼€å‘æŒ‡å—

### 1. æœ¬åœ°å¼€å‘
```bash
# å…‹éš†ä»£ç 
git clone <repository>

# å¯åŠ¨ä¾èµ–æœåŠ¡
docker-compose -f docker/docker-compose.yml up -d

# è¿è¡ŒæœåŠ¡
mvn spring-boot:run
```

### 2. å•å…ƒæµ‹è¯•
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
mvn test

# è¿è¡Œç‰¹å®šæµ‹è¯•
mvn test -Dtest=UserServiceTest
```

### 3. ä»£ç é£æ ¼
- éµå¾ªé˜¿é‡Œå·´å·´Javaå¼€å‘è§„èŒƒ
- ä½¿ç”¨Lombokç®€åŒ–ä»£ç 
- MapStructå¤„ç†å¯¹è±¡è½¬æ¢
- å®Œæ•´çš„JavaDocæ³¨é‡Š

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. æŸ¥è¯¢ä¼˜åŒ–
- ä½¿ç”¨åˆé€‚çš„ç´¢å¼•
- åˆ†é¡µæŸ¥è¯¢é¿å…æ·±åº¦åˆ†é¡µ
- æ‰¹é‡æ“ä½œä¼˜åŒ–

### 2. ç¼“å­˜ç­–ç•¥
- ç”¨æˆ·åŸºæœ¬ä¿¡æ¯Redisç¼“å­˜
- åœ°å€ä¿¡æ¯æœ¬åœ°ç¼“å­˜
- ç¼“å­˜æ›´æ–°ç­–ç•¥

### 3. å¹¶å‘æ§åˆ¶
- ä¹è§‚é”æ§åˆ¶å¹¶å‘
- åˆ†å¸ƒå¼é”ä¿è¯ä¸€è‡´æ€§

## ğŸ“ å¾…å®Œå–„åŠŸèƒ½

- [ ] ç”¨æˆ·å¤´åƒä¸Šä¼ åŠŸèƒ½
- [ ] æ‰¹é‡ç”¨æˆ·æ“ä½œæ¥å£
- [ ] ç”¨æˆ·è¡Œä¸ºåˆ†æ
- [ ] å®åè®¤è¯åŠŸèƒ½
- [ ] ç¤¾äº¤ç™»å½•æ‰©å±•ï¼ˆå¾®ä¿¡ã€QQç­‰ï¼‰

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯
3. æäº¤ä»£ç æ›´æ”¹
4. æ¨é€åˆ°åˆ†æ”¯
5. åˆ›å»º Pull Request

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿæˆ–æäº¤Issueã€‚

---

**ç‰ˆæœ¬**: v0.0.1-SNAPSHOT  
**æœ€åæ›´æ–°**: 2025-01-25  
**ç»´æŠ¤è€…**: Cloud Platform Team
