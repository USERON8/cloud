spring:
  cloud:
    stream:
      # 定义函数绑定
      function:
        definition: paymentSuccessConsumer;stockFreezeFailedConsumer;refundCompletedConsumer;refundCreatedNotificationConsumer;refundAuditedNotificationConsumer;refundProcessNotificationConsumer;refundCancelledNotificationConsumer

      # RocketMQ Binder配置
      rocketmq:
        binder:
          name-server: ${ROCKETMQ_NAME_SERVER:127.0.0.1:39876}
        bindings:
          # 订单创建事件生产者
          orderCreatedProducer-out-0:
            producer:
              group: order-producer-group
              sync: false  # 异步发送

          # 订单取消事件生产者
          orderCancelledProducer-out-0:
            producer:
              group: order-producer-group
              sync: false

          # 退款相关生产者
          refundCreatedProducer-out-0:
            producer:
              group: order-producer-group
              sync: false

          refundAuditedProducer-out-0:
            producer:
              group: order-producer-group
              sync: false

          refundProcessProducer-out-0:
            producer:
              group: order-producer-group
              sync: false

          refundCancelledProducer-out-0:
            producer:
              group: order-producer-group
              sync: false

          # 库存恢复事件生产者
          stockRestoreProducer-out-0:
            producer:
              group: order-producer-group
              sync: false

          # 支付成功事件消费者
          paymentSuccessConsumer-in-0:
            consumer:
              # 标签过滤
              subscription: 'PAYMENT_SUCCESS'
              # 并发消费
              orderly: false

          # 库存冻结失败事件消费者
          stockFreezeFailedConsumer-in-0:
            consumer:
              subscription: 'STOCK_FREEZE_FAILED'
              orderly: false

          # 退款完成事件消费者
          refundCompletedConsumer-in-0:
            consumer:
              subscription: 'REFUND_COMPLETED'
              orderly: false

          # 退款通知消费者（独立消费者组）
          refundCreatedNotificationConsumer-in-0:
            consumer:
              subscription: 'REFUND_CREATED'
              orderly: false

          refundAuditedNotificationConsumer-in-0:
            consumer:
              subscription: 'REFUND_AUDITED'
              orderly: false

          refundProcessNotificationConsumer-in-0:
            consumer:
              subscription: 'REFUND_PROCESS'
              orderly: false

          refundCancelledNotificationConsumer-in-0:
            consumer:
              subscription: 'REFUND_CANCELLED'
              orderly: false

      # Binding配置
      bindings:
        # 订单创建事件 - 输出
        orderCreatedProducer-out-0:
          destination: order-created
          content-type: application/json

        # 订单取消事件 - 输出
        orderCancelledProducer-out-0:
          destination: order-cancelled
          content-type: application/json

        # 退款创建事件 - 输出
        refundCreatedProducer-out-0:
          destination: refund-created
          content-type: application/json

        # 退款审核事件 - 输出
        refundAuditedProducer-out-0:
          destination: refund-audited
          content-type: application/json

        # 退款处理事件 - 输出
        refundProcessProducer-out-0:
          destination: refund-process
          content-type: application/json

        # 退款取消事件 - 输出
        refundCancelledProducer-out-0:
          destination: refund-cancelled
          content-type: application/json

        # 库存恢复事件 - 输出
        stockRestoreProducer-out-0:
          destination: stock-restore
          content-type: application/json

        # 支付成功事件 - 输入
        paymentSuccessConsumer-in-0:
          destination: payment-success
          content-type: application/json
          group: order-consumer-group

        # 库存冻结失败事件 - 输入
        stockFreezeFailedConsumer-in-0:
          destination: stock-freeze-failed
          content-type: application/json
          group: order-consumer-group

        # 退款完成事件 - 输入
        refundCompletedConsumer-in-0:
          destination: refund-completed
          content-type: application/json
          group: order-consumer-group

        # 退款通知消费者 - 输入（独立消费者组，用于通知功能）
        refundCreatedNotificationConsumer-in-0:
          destination: refund-created
          content-type: application/json
          group: order-notification-group

        refundAuditedNotificationConsumer-in-0:
          destination: refund-audited
          content-type: application/json
          group: order-notification-group

        refundProcessNotificationConsumer-in-0:
          destination: refund-process
          content-type: application/json
          group: order-notification-group

        refundCancelledNotificationConsumer-in-0:
          destination: refund-cancelled
          content-type: application/json
          group: order-notification-group
