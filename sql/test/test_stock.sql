-- ==================== 库存数据库测试数据 (stock_db) ====================
-- 版本: v2.0
-- 更新时间: 2025-01-16
-- 说明: 包含库存主表、入库记录、出库记录、库存日志、库存盘点的测试数据
-- ==================================================================================
USE `stock_db`;

-- 清空现有测试数据
TRUNCATE TABLE `stock_count`;
TRUNCATE TABLE `stock_log`;
TRUNCATE TABLE `stock_out`;
TRUNCATE TABLE `stock_in`;
TRUNCATE TABLE `stock`;

-- ==================== 1. 库存主表测试数据 ====================
-- 包含正常库存、低库存、缺货等场景
INSERT INTO `stock` (id, product_id, product_name, stock_quantity, frozen_quantity, stock_status, low_stock_threshold,
                     version)
VALUES (1, 1, 'iPhone 15 Pro', 100, 10, 1, 20, 0), -- 正常库存,已有10件冻结
       (2, 2, 'MacBook Pro 14', 50, 5, 1, 30, 0),  -- 低库存(可用45 < 预警30)
       (3, 3, '男士T恤', 200, 0, 1, 50, 0),        -- 正常库存
       (4, 4, '女士连衣裙', 15, 5, 1, 20, 0),      -- 低库存(可用10 < 预警20)
       (5, 5, 'AirPods Pro', 5, 3, 2, 10, 0),      -- 缺货状态(可用2 < 预警10)
       (6, 6, 'iPad Air', 0, 0, 3, 15, 0),         -- 下架状态
       (7, 7, 'Apple Watch', 80, 0, 1, 25, 0);
-- 正常库存

-- ==================== 2. 入库记录测试数据 ====================
INSERT INTO `stock_in` (id, product_id, quantity, created_at)
VALUES (1, 1, 100, '2025-01-10 10:00:00'), -- iPhone 15 Pro 初始入库
       (2, 2, 50, '2025-01-10 10:00:00'),  -- MacBook Pro 14 初始入库
       (3, 3, 200, '2025-01-10 10:00:00'), -- 男士T恤 初始入库
       (4, 4, 20, '2025-01-10 10:00:00'),  -- 女士连衣裙 初始入库
       (5, 5, 10, '2025-01-10 10:00:00'),  -- AirPods Pro 初始入库
       (6, 1, 50, '2025-01-12 14:30:00'),  -- iPhone 15 Pro 补货入库
       (7, 2, 20, '2025-01-13 09:15:00'),  -- MacBook Pro 14 补货入库
       (8, 4, 10, '2025-01-14 11:20:00');
-- 女士连衣裙 补货入库

-- ==================== 3. 出库记录测试数据 ====================
INSERT INTO `stock_out` (id, product_id, order_id, quantity, created_at)
VALUES (1, 1, 1001, 1, '2025-01-11 10:30:00'), -- iPhone 15 Pro 出库
       (2, 3, 1002, 1, '2025-01-11 11:00:00'), -- 男士T恤 出库
       (3, 3, 1003, 1, '2025-01-11 14:30:00'), -- 男士T恤 出库
       (4, 4, 1004, 1, '2025-01-12 09:00:00'), -- 女士连衣裙 出库
       (5, 1, 1005, 2, '2025-01-12 15:20:00'), -- iPhone 15 Pro 出库2件
       (6, 5, 1006, 5, '2025-01-13 10:00:00'), -- AirPods Pro 出库5件
       (7, 2, 1007, 3, '2025-01-13 16:30:00'), -- MacBook Pro 14 出库3件
       (8, 4, 1008, 4, '2025-01-14 10:15:00');
-- 女士连衣裙 出库4件

-- ==================== 4. 库存日志测试数据 ====================
-- 包含入库、出库、预留、释放、调整、盘点等操作类型
INSERT INTO `stock_log` (id, product_id, product_name, operation_type, quantity_before, quantity_after, quantity_change,
                         order_id, order_no, operator_id, operator_name, remark, operate_time, ip_address)
VALUES
-- 初始入库操作
(1, 1, 'iPhone 15 Pro', 'IN', 0, 100, 100, NULL, NULL, 1, '系统管理员', '初始入库', '2025-01-10 10:00:00',
 '192.168.1.100'),
(2, 2, 'MacBook Pro 14', 'IN', 0, 50, 50, NULL, NULL, 1, '系统管理员', '初始入库', '2025-01-10 10:00:00',
 '192.168.1.100'),
(3, 3, '男士T恤', 'IN', 0, 200, 200, NULL, NULL, 1, '系统管理员', '初始入库', '2025-01-10 10:00:00', '192.168.1.100'),

-- 订单预留操作
(4, 1, 'iPhone 15 Pro', 'RESERVE', 100, 99, -1, 1001, 'ORD20250111001', NULL, '系统', '订单预留库存',
 '2025-01-11 10:30:00', '172.16.10.50'),
(5, 3, '男士T恤', 'RESERVE', 200, 199, -1, 1002, 'ORD20250111002', NULL, '系统', '订单预留库存', '2025-01-11 11:00:00',
 '172.16.10.51'),

-- 出库操作
(6, 1, 'iPhone 15 Pro', 'OUT', 99, 98, -1, 1001, 'ORD20250111001', NULL, '系统', '订单出库', '2025-01-11 10:35:00',
 '172.16.10.50'),
(7, 3, '男士T恤', 'OUT', 199, 198, -1, 1002, 'ORD20250111002', NULL, '系统', '订单出库', '2025-01-11 11:05:00',
 '172.16.10.51'),

-- 补货入库操作
(8, 1, 'iPhone 15 Pro', 'IN', 98, 148, 50, NULL, NULL, 2, '仓库管理员A', '供应商补货', '2025-01-12 14:30:00',
 '192.168.1.101'),
(9, 2, 'MacBook Pro 14', 'IN', 50, 70, 20, NULL, NULL, 2, '仓库管理员A', '供应商补货', '2025-01-13 09:15:00',
 '192.168.1.101'),

-- 订单取消释放库存
(10, 5, 'AirPods Pro', 'RELEASE', 3, 5, 2, 1009, 'ORD20250113003', NULL, '系统', '订单取消,释放库存',
 '2025-01-13 12:00:00', '172.16.10.52'),

-- 库存调整操作
(11, 4, '女士连衣裙', 'ADJUST', 25, 20, -5, NULL, NULL, 3, '仓库主管', '损坏商品调整', '2025-01-13 16:00:00',
 '192.168.1.102'),
(12, 5, 'AirPods Pro', 'ADJUST', 10, 8, -2, NULL, NULL, 3, '仓库主管', '过期商品调整', '2025-01-14 09:00:00',
 '192.168.1.102'),

-- 盘点操作
(13, 2, 'MacBook Pro 14', 'COUNT', 67, 65, -2, NULL, NULL, 4, '盘点员A', '盘点差异调整', '2025-01-14 15:00:00',
 '192.168.1.103'),
(14, 3, '男士T恤', 'COUNT', 198, 200, 2, NULL, NULL, 4, '盘点员A', '盘点差异调整', '2025-01-14 15:05:00',
 '192.168.1.103'),

-- 秒杀预留操作
(15, 1, 'iPhone 15 Pro', 'RESERVE', 148, 138, -10, NULL, NULL, NULL, '系统', '秒杀活动预留', '2025-01-15 10:00:00',
 '172.16.10.60'),
(16, 7, 'Apple Watch', 'RESERVE', 80, 75, -5, NULL, NULL, NULL, '系统', '秒杀活动预留', '2025-01-15 10:00:00',
 '172.16.10.60');

-- ==================== 5. 库存盘点测试数据 ====================
-- 包含盘盈、盘亏、平账等场景
INSERT INTO `stock_count` (id, count_no, product_id, product_name, expected_quantity, actual_quantity, difference,
                           status, operator_id, operator_name, confirm_user_id, confirm_user_name,
                           count_time, confirm_time, remark)
VALUES
-- 已确认的盘点记录
(1, 'COUNT2025011400001', 2, 'MacBook Pro 14', 67, 65, -2, 'CONFIRMED',
 4, '盘点员A', 3, '仓库主管', '2025-01-14 14:30:00', '2025-01-14 15:00:00', '盘亏2件,已确认调整'),

(2, 'COUNT2025011400002', 3, '男士T恤', 198, 200, 2, 'CONFIRMED',
 4, '盘点员A', 3, '仓库主管', '2025-01-14 14:45:00', '2025-01-14 15:05:00', '盘盈2件,已确认调整'),

(3, 'COUNT2025011400003', 7, 'Apple Watch', 80, 80, 0, 'CONFIRMED',
 4, '盘点员A', 3, '仓库主管', '2025-01-14 15:00:00', '2025-01-14 15:10:00', '盘点数量一致'),

-- 待确认的盘点记录
(4, 'COUNT2025011500001', 1, 'iPhone 15 Pro', 148, 145, -3, 'PENDING',
 5, '盘点员B', NULL, NULL, '2025-01-15 09:00:00', NULL, '待确认盘点差异'),

(5, 'COUNT2025011500002', 4, '女士连衣裙', 20, 22, 2, 'PENDING',
 5, '盘点员B', NULL, NULL, '2025-01-15 09:15:00', NULL, '待确认盘点差异'),

(6, 'COUNT2025011500003', 5, 'AirPods Pro', 8, 6, -2, 'PENDING',
 5, '盘点员B', NULL, NULL, '2025-01-15 09:30:00', NULL, '待确认盘点差异,怀疑丢失'),

-- 已取消的盘点记录
(7, 'COUNT2025011400004', 1, 'iPhone 15 Pro', 100, 102, 2, 'CANCELLED',
 4, '盘点员A', NULL, NULL, '2025-01-14 10:00:00', NULL, '盘点时正值秒杀活动,数据不准确,已取消'),

(8, 'COUNT2025011400005', 6, 'iPad Air', 5, 0, -5, 'CANCELLED',
 4, '盘点员A', NULL, NULL, '2025-01-14 11:00:00', NULL, '该商品已下架,无需盘点');

COMMIT;

-- ==================== 测试数据说明 ====================
--
-- 1. 库存状态场景:
--    - 正常库存: product_id=1,3,7
--    - 低库存预警: product_id=2,4 (可用库存 < 预警阈值)
--    - 缺货状态: product_id=5
--    - 下架状态: product_id=6
--
-- 2. 库存日志操作类型:
--    - IN: 入库操作 (初始入库、补货入库)
--    - OUT: 出库操作 (订单出库)
--    - RESERVE: 预留操作 (订单预留、秒杀预留)
--    - RELEASE: 释放操作 (订单取消)
--    - ADJUST: 调整操作 (损坏、过期等)
--    - COUNT: 盘点操作 (盘点差异调整)
--
-- 3. 库存盘点状态:
--    - PENDING: 待确认 (3条记录,包含盘盈、盘亏场景)
--    - CONFIRMED: 已确认 (3条记录,已自动调整库存)
--    - CANCELLED: 已取消 (2条记录,盘点作废)
--
-- 4. 测试场景覆盖:
--    - 正常入库出库流程
--    - 订单预留和释放
--    - 低库存预警
--    - 库存盘点(盘盈、盘亏、平账)
--    - 库存调整
--    - 秒杀活动预留
--    - 多操作人员
--    - 不同IP地址操作记录
--
