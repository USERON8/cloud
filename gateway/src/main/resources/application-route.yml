spring:
  cloud:
    gateway:
      routes:
        # ===== OAuth2.1 标准端点路由 (最高优先级) =====

        - id: oauth2-authorize-route
          uri: lb://auth-service
          predicates:
            - Path=/oauth2/authorize
          filters:
            - PreserveHostHeader

        - id: oauth2-token-route
          uri: lb://auth-service
          predicates:
            - Path=/oauth2/token
          filters:
            - PreserveHostHeader

        - id: oauth2-revoke-route
          uri: lb://auth-service
          predicates:
            - Path=/oauth2/revoke
          filters:
            - PreserveHostHeader

        - id: oauth2-introspect-route
          uri: lb://auth-service
          predicates:
            - Path=/oauth2/introspect
          filters:
            - PreserveHostHeader

        - id: oauth2-jwks-route
          uri: lb://auth-service
          predicates:
            - Path=/.well-known/jwks.json
          filters:
            - PreserveHostHeader

        - id: oauth2-openid-config-route
          uri: lb://auth-service
          predicates:
            - Path=/.well-known/openid_configuration
          filters:
            - PreserveHostHeader

        - id: oauth2-userinfo-route
          uri: lb://auth-service
          predicates:
            - Path=/userinfo
          filters:
            - PreserveHostHeader

        # ===== RESTful API 路由 (统一 /api/v1 前缀) =====

        # 认证服务 API
        - id: auth-api-v1-route
          uri: lb://auth-service
          predicates:
            - Path=/api/v1/auth/**
          filters:
            - RewritePath=/api/v1/auth/(?<segment>.*), /auth/$\{segment}
          metadata:
            swagger-info:
              title: 认证服务API
              description: 用户认证、登录注册、令牌管理
              group: auth-service
              version: v1

        # 用户服务 API
        - id: user-api-v1-route
          uri: lb://user-service
          predicates:
            - Path=/api/v1/users/**
          filters:
            - RewritePath=/api/v1/users/(?<segment>.*), /users/$\{segment}
          metadata:
            swagger-info:
              title: 用户服务API
              description: 用户管理、档案、地址等
              group: user-service
              version: v1

        # 商家服务 API
        - id: merchant-api-v1-route
          uri: lb://user-service
          predicates:
            - Path=/api/v1/merchants/**
          filters:
            - RewritePath=/api/v1/merchants/(?<segment>.*), /merchants/$\{segment}
          metadata:
            swagger-info:
              title: 商家服务API
              description: 商家管理、店铺等
              group: user-service
              version: v1

        # 商品服务 API
        - id: product-api-v1-route
          uri: lb://product-service
          predicates:
            - Path=/api/v1/products/**
          filters:
            - RewritePath=/api/v1/products/(?<segment>.*), /products/$\{segment}
          metadata:
            swagger-info:
              title: 商品服务API
              description: 商品管理、规格、评价等
              group: product-service
              version: v1

        # 分类服务 API
        - id: category-api-v1-route
          uri: lb://product-service
          predicates:
            - Path=/api/v1/categories/**
          filters:
            - RewritePath=/api/v1/categories/(?<segment>.*), /categories/$\{segment}
          metadata:
            swagger-info:
              title: 分类服务API
              description: 商品分类管理
              group: product-service
              version: v1

        # 品牌服务 API
        - id: brand-api-v1-route
          uri: lb://product-service
          predicates:
            - Path=/api/v1/brands/**
          filters:
            - RewritePath=/api/v1/brands/(?<segment>.*), /brands/$\{segment}
          metadata:
            swagger-info:
              title: 品牌服务API
              description: 品牌管理
              group: product-service
              version: v1

        # 订单服务 API
        - id: order-api-v1-route
          uri: lb://order-service
          predicates:
            - Path=/api/v1/orders/**
          filters:
            - RewritePath=/api/v1/orders/(?<segment>.*), /orders/$\{segment}
          metadata:
            swagger-info:
              title: 订单服务API
              description: 订单管理、订单项、发货等
              group: order-service
              version: v1

        # 购物车服务 API
        - id: cart-api-v1-route
          uri: lb://order-service
          predicates:
            - Path=/api/v1/carts/**
          filters:
            - RewritePath=/api/v1/carts/(?<segment>.*), /carts/$\{segment}
          metadata:
            swagger-info:
              title: 购物车服务API
              description: 购物车管理
              group: order-service
              version: v1

        # 支付服务 API
        - id: payment-api-v1-route
          uri: lb://payment-service
          predicates:
            - Path=/api/v1/payments/**
          filters:
            - RewritePath=/api/v1/payments/(?<segment>.*), /payments/$\{segment}
          metadata:
            swagger-info:
              title: 支付服务API
              description: 支付记录、退款、交易等
              group: payment-service
              version: v1

        # 支付方式服务 API
        - id: payment-method-api-v1-route
          uri: lb://payment-service
          predicates:
            - Path=/api/v1/payment-methods/**
          filters:
            - RewritePath=/api/v1/payment-methods/(?<segment>.*), /payment-methods/$\{segment}
          metadata:
            swagger-info:
              title: 支付方式API
              description: 支付方式管理
              group: payment-service
              version: v1

        # 交易服务 API
        - id: transaction-api-v1-route
          uri: lb://payment-service
          predicates:
            - Path=/api/v1/transactions/**
          filters:
            - RewritePath=/api/v1/transactions/(?<segment>.*), /transactions/$\{segment}
          metadata:
            swagger-info:
              title: 交易服务API
              description: 交易记录管理
              group: payment-service
              version: v1

        # 库存服务 API
        - id: stock-api-v1-route
          uri: lb://stock-service
          predicates:
            - Path=/api/v1/stocks/**
          filters:
            - RewritePath=/api/v1/stocks/(?<segment>.*), /stocks/$\{segment}
          metadata:
            swagger-info:
              title: 库存服务API
              description: 库存管理、预留、调整等
              group: stock-service
              version: v1

        # 仓库服务 API
        - id: warehouse-api-v1-route
          uri: lb://stock-service
          predicates:
            - Path=/api/v1/warehouses/**
          filters:
            - RewritePath=/api/v1/warehouses/(?<segment>.*), /warehouses/$\{segment}
          metadata:
            swagger-info:
              title: 仓库服务API
              description: 仓库管理
              group: stock-service
              version: v1

        # 搜索服务 API
        - id: search-api-v1-route
          uri: lb://search-service
          predicates:
            - Path=/api/v1/search/**
          filters:
            - RewritePath=/api/v1/search/(?<segment>.*), /search/$\{segment}
          metadata:
            swagger-info:
              title: 搜索服务API
              description: 商品搜索、建议、分析等
              group: search-service
              version: v1

        # 日志服务 API
        - id: log-api-v1-route
          uri: lb://log-service
          predicates:
            - Path=/api/v1/logs/**
          filters:
            - RewritePath=/api/v1/logs/(?<segment>.*), /logs/$\{segment}
          metadata:
            swagger-info:
              title: 日志服务API
              description: 系统日志、操作日志、审计日志等
              group: log-service
              version: v1

        # ===== 兼容性路由 (向后兼容旧版API) =====

        # 认证服务兼容路由
        - id: auth-legacy-route
          uri: lb://auth-service
          predicates:
            - Path=/auth/**,/oauth2/**
          metadata:
            swagger-info:
              title: 认证服务(兼容)
              description: OAuth2.1认证授权服务
              group: auth-service

        # 用户服务兼容路由
        - id: user-legacy-route
          uri: lb://user-service
          predicates:
            - Path=/user/**,/admin/**,/merchant/**
          metadata:
            swagger-info:
              title: 用户服务(兼容)
              description: 用户管理服务
              group: user-service

        # 商品服务兼容路由
        - id: product-legacy-route
          uri: lb://product-service
          predicates:
            - Path=/product/**,/category/**
          metadata:
            swagger-info:
              title: 商品服务(兼容)
              description: 商品管理服务
              group: product-service

        # 订单服务兼容路由
        - id: order-legacy-route
          uri: lb://order-service
          predicates:
            - Path=/order/**
          metadata:
            swagger-info:
              title: 订单服务(兼容)
              description: 订单管理服务
              group: order-service

        # 支付服务兼容路由
        - id: payment-legacy-route
          uri: lb://payment-service
          predicates:
            - Path=/payment/**
          metadata:
            swagger-info:
              title: 支付服务(兼容)
              description: 支付管理服务
              group: payment-service

        # 库存服务兼容路由
        - id: stock-legacy-route
          uri: lb://stock-service
          predicates:
            - Path=/stock/**
          metadata:
            swagger-info:
              title: 库存服务(兼容)
              description: 库存管理服务
              group: stock-service

        # 搜索服务兼容路由
        - id: search-legacy-route
          uri: lb://search-service
          predicates:
            - Path=/search/**
          metadata:
            swagger-info:
              title: 搜索服务(兼容)
              description: 商品搜索服务
              group: search-service

        # 日志服务兼容路由
        - id: log-legacy-route
          uri: lb://log-service
          predicates:
            - Path=/log/**
          metadata:
            swagger-info:
              title: 日志服务(兼容)
              description: 系统日志服务
              group: log-service
      # ===== 服务发现配置 =====
      discovery:
        locator:
          # 在网关中禁用自动服务发现，优先使用手动配置的路由
          enabled: false
          lower-case-service-id: true
          # 防止与手动路由冲突，提高路由匹配的可预测性
