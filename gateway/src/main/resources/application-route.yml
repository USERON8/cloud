spring:
  cloud:
    gateway:
      routes:
        # ===== 认证服务路由 (按优先级排序) =====
        
        # 1. OAuth2.1 标准端点路由 - 最高优先级
        - id: oauth2-authorize-route
          uri: lb://auth-service
          predicates:
            - Path=/oauth2/authorize
          filters:
            - PreserveHostHeader
            
        - id: oauth2-token-route
          uri: lb://auth-service
          predicates:
            - Path=/oauth2/token
          filters:
            - PreserveHostHeader
            
        - id: oauth2-revoke-route
          uri: lb://auth-service
          predicates:
            - Path=/oauth2/revoke
          filters:
            - PreserveHostHeader
            
        - id: oauth2-introspect-route
          uri: lb://auth-service
          predicates:
            - Path=/oauth2/introspect
          filters:
            - PreserveHostHeader
            
        - id: oauth2-jwks-route
          uri: lb://auth-service
          predicates:
            - Path=/.well-known/jwks.json
          filters:
            - PreserveHostHeader
            
        - id: oauth2-openid-config-route
          uri: lb://auth-service
          predicates:
            - Path=/.well-known/openid_configuration
          filters:
            - PreserveHostHeader
            
        - id: oauth2-userinfo-route
          uri: lb://auth-service
          predicates:
            - Path=/userinfo
          filters:
            - PreserveHostHeader
        
        # 2. 认证服务API路由 - 高优先级
        - id: auth-api-route
          uri: lb://auth-service
          predicates:
            - Path=/api/auth/**
          filters:
            - RewritePath=/api/auth/(?<segment>.*), /auth/api/$\{segment}
        
        # 3. 认证页面路由
        - id: auth-login-page-route
          uri: lb://auth-service
          predicates:
            - Path=/login,/login/**,/register/**,/logout/**
          filters:
            - PreserveHostHeader
        
        # 4. 认证服务直接路径
        - id: auth-service-route
          uri: lb://auth-service
          predicates:
            - Path=/auth-service/**
          filters:
            - RewritePath=/auth-service/(?<segment>.*), /$\{segment}
        
        # 5. 认证服务通用路由 - 较低优先级
        - id: auth-route
          uri: lb://auth-service
          predicates:
            - Path=/auth/**,/authorized/**
          metadata:
            swagger-info:
              title: 认证服务API
              description: OAuth2.1认证授权服务
              group: auth-service
              servicePath: /v3/api-docs
              location: /auth/**
        
        # ===== 用户服务路由 (按优先级排序) =====
        
        # 1. 用户服务API路由 - 高优先级
        - id: user-api-route
          uri: lb://user-service
          predicates:
            - Path=/api/user/**
          filters:
            - RewritePath=/api/user/(?<segment>.*), /user/api/$\{segment}
        
        # 2. 用户服务直接路径
        - id: user-service-route
          uri: lb://user-service
          predicates:
            - Path=/user-service/**
          filters:
            - RewritePath=/user-service/(?<segment>.*), /$\{segment}
        
        # 3. 管理员和商家特定路由 - 中优先级
        - id: user-admin-route
          uri: lb://user-service
          predicates:
            - Path=/admin/**
          metadata:
            swagger-info:
              title: 管理员API
              description: 管理员相关接口
              group: user-service
              servicePath: /v3/api-docs
              location: /admin/**
              
        - id: user-merchant-route
          uri: lb://user-service
          predicates:
            - Path=/merchant/**
          metadata:
            swagger-info:
              title: 商家API
              description: 商家相关接口
              group: user-service
              servicePath: /v3/api-docs
              location: /merchant/**
        
        # 4. 用户服务通用路由 - 较低优先级
        - id: user-route
          uri: lb://user-service
          predicates:
            - Path=/user/**,/avatar/**
          metadata:
            swagger-info:
              title: 用户服务API
              description: 用户管理与头像服务
              group: user-service
              servicePath: /v3/api-docs
              location: /user/**,/avatar/**
        
        # ===== 其他服务路由 (统一模式) =====
        
        # 库存服务路由
        - id: stock-api-route
          uri: lb://stock-service
          predicates:
            - Path=/api/stock/**
          filters:
            - RewritePath=/api/stock/(?<segment>.*), /stock/api/$\{segment}
            
        - id: stock-service-route
          uri: lb://stock-service
          predicates:
            - Path=/stock-service/**
          filters:
            - RewritePath=/stock-service/(?<segment>.*), /$\{segment}
            
        - id: stock-route
          uri: lb://stock-service
          predicates:
            - Path=/stock/**
          metadata:
            swagger-info:
              title: 库存服务API
              description: 库存管理服务
              group: stock-service
              servicePath: /v3/api-docs
              location: /stock/**
        
        # 订单服务路由
        - id: order-api-route
          uri: lb://order-service
          predicates:
            - Path=/api/order/**
          filters:
            - RewritePath=/api/order/(?<segment>.*), /order/api/$\{segment}
            
        - id: order-service-route
          uri: lb://order-service
          predicates:
            - Path=/order-service/**
          filters:
            - RewritePath=/order-service/(?<segment>.*), /$\{segment}
            
        - id: order-route
          uri: lb://order-service
          predicates:
            - Path=/order/**
          metadata:
            swagger-info:
              title: 订单服务API
              description: 订单管理服务
              group: order-service
              servicePath: /v3/api-docs
              location: /order/**
        
        # 商品服务路由
        - id: product-api-route
          uri: lb://product-service
          predicates:
            - Path=/api/product/**
          filters:
            - RewritePath=/api/product/(?<segment>.*), /product/api/$\{segment}
            
        - id: product-service-route
          uri: lb://product-service
          predicates:
            - Path=/product-service/**
          filters:
            - RewritePath=/product-service/(?<segment>.*), /$\{segment}
            
        - id: product-route
          uri: lb://product-service
          predicates:
            - Path=/product/**
          metadata:
            swagger-info:
              title: 商品服务API
              description: 商品管理服务
              group: product-service
              servicePath: /v3/api-docs
              location: /product/**
        
        # 支付服务路由
        - id: payment-api-route
          uri: lb://payment-service
          predicates:
            - Path=/api/payment/**
          filters:
            - RewritePath=/api/payment/(?<segment>.*), /payment/api/$\{segment}
            
        - id: payment-service-route
          uri: lb://payment-service
          predicates:
            - Path=/payment-service/**
          filters:
            - RewritePath=/payment-service/(?<segment>.*), /$\{segment}
            
        - id: payment-route
          uri: lb://payment-service
          predicates:
            - Path=/payment/**
          metadata:
            swagger-info:
              title: 支付服务API
              description: 支付管理服务
              group: payment-service
              servicePath: /v3/api-docs
              location: /payment/**
        
        # 搜索服务路由
        - id: search-api-route
          uri: lb://search-service
          predicates:
            - Path=/api/search/**
          filters:
            - RewritePath=/api/search/(?<segment>.*), /search/api/$\{segment}
            
        - id: search-route
          uri: lb://search-service
          predicates:
            - Path=/search/**
          metadata:
            swagger-info:
              title: 搜索服务API
              description: 商品搜索服务
              group: search-service
              servicePath: /v3/api-docs
              location: /search/**
        
        # 日志服务路由
        - id: log-api-route
          uri: lb://log-service
          predicates:
            - Path=/api/log/**
          filters:
            - RewritePath=/api/log/(?<segment>.*), /log/api/$\{segment}
            
        - id: log-route
          uri: lb://log-service
          predicates:
            - Path=/log/**
          metadata:
            swagger-info:
              title: 日志服务API
              description: 系统日志服务
              group: log-service
              servicePath: /v3/api-docs
              location: /log/**
      # ===== 服务发现配置 =====
      discovery:
        locator:
          # 在网关中禁用自动服务发现，优先使用手动配置的路由
          enabled: false
          lower-case-service-id: true
          # 防止与手动路由冲突，提高路由匹配的可预测性
